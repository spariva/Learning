ALTER SESSION SET NLS_DATE_FORMAT='DD/MM/YYYY';

DROP TABLE FACTURA CASCADE CONSTRAINT;
CREATE TABLE FACTURA(
    NUMERO VARCHAR2(4) PRIMARY KEY,
    FECHA DATE NOT NULL,
    IVA NUMBER(3) NOT NULL
);

DROP TABLE CLIENTE CASCADE CONSTRAINT;
CREATE TABLE CLIENTE(
    DNI VARCHAR2(9) PRIMARY KEY,
    NOMBRE VARCHAR2(15) NOT NULL,
    DIRECCION VARCHAR2(20) NOT NULL,
    TELEFONO NUMBER(9) NOT NULL
);

DROP TABLE CABECERA_PEDIDO CASCADE CONSTRAINT;
CREATE TABLE CABECERA_PEDIDO(
    NUM_PEDIDO VARCHAR2(4) PRIMARY KEY,
    FECHA DATE NOT NULL,
    DNI VARCHAR2(9) NOT NULL, 
    CONSTRAINT FK_DNI_PED FOREIGN KEY (DNI) REFERENCES CLIENTE(DNI) ON DELETE CASCADE
);

DROP TABLE CABECERA_ALBARAN CASCADE CONSTRAINT;
CREATE TABLE CABECERA_ALBARAN(
    NUM_ALBARAN VARCHAR2(9) PRIMARY KEY,
    FECHA DATE NOT NULL,
    NUM_PEDIDO VARCHAR2(4) NOT NULL,
    NUMERO_FACT VARCHAR2(4) NOT NULL,
    CONSTRAINT FK_ALB_PED FOREIGN KEY (NUM_PEDIDO) REFERENCES CABECERA_PEDIDO(NUM_PEDIDO) ON DELETE CASCADE,
    CONSTRAINT FK_ALB_FAC FOREIGN KEY (NUMERO_FACT) REFERENCES FACTURA(NUMERO) ON DELETE CASCADE
);

DROP TABLE EMPRESA CASCADE CONSTRAINT;
CREATE TABLE EMPRESA(
    CIF VARCHAR2(9) PRIMARY KEY,
    NOMBRE VARCHAR2(20) NOT NULL,
    DIRECCION VARCHAR2(20) NOT NULL
);

DROP TABLE PRODUCTOS CASCADE CONSTRAINT;
CREATE TABLE PRODUCTOS(
    CODIGO VARCHAR2(9) PRIMARY KEY,
    NOMBRE VARCHAR2(15) NOT NULL,
    PRECIO NUMBER(4,2) NOT NULL,
    CIF VARCHAR2(9) NOT NULL,
    CONSTRAINT FK_PROD_EMP FOREIGN KEY (CIF) REFERENCES EMPRESA(CIF) ON DELETE CASCADE
);

DROP TABLE LINEA_PEDIDO CASCADE CONSTRAINT;
CREATE TABLE LINEA_PEDIDO(
    NUM_LINEA VARCHAR2(2) NOT NULL,
    CANTIDAD NUMBER(4) NOT NULL,
    NUM_PEDIDO VARCHAR2(4) NOT NULL,
    COD_PRODUCTO VARCHAR2(9) NOT NULL,
    CONSTRAINT FK_LINPED_PED FOREIGN KEY (NUM_PEDIDO) REFERENCES CABECERA_PEDIDO(NUM_PEDIDO) ON DELETE CASCADE,
    CONSTRAINT FK_LINPED_PROD FOREIGN KEY (COD_PRODUCTO) REFERENCES PRODUCTOS(CODIGO) ON DELETE CASCADE,
    CONSTRAINT PK_LINEA_PED PRIMARY KEY (NUM_PEDIDO, NUM_LINEA, COD_PRODUCTO)
);

DROP TABLE LINEA_ALBARAN CASCADE CONSTRAINT;
CREATE TABLE LINEA_ALBARAN(
    NUM_LINEA VARCHAR2(2) NOT NULL,
    CANTIDAD NUMBER(4) NOT NULL,
    NUM_ALBARAN VARCHAR2(9) NOT NULL,
    COD_PROD VARCHAR2(9) NOT NULL,
    CONSTRAINT FK_LINALB_PROD FOREIGN KEY (COD_PROD) REFERENCES PRODUCTOS(CODIGO) ON DELETE CASCADE,
    CONSTRAINT FK_LINALB_CABALB FOREIGN KEY (NUM_ALBARAN) REFERENCES CABECERA_ALBARAN(NUM_ALBARAN) ON DELETE CASCADE,
    CONSTRAINT PK_LINALB PRIMARY KEY (NUM_ALBARAN, NUM_LINEA, COD_PROD)
);

INSERT INTO FACTURA VALUES('F001','01/03/2023', 21);
INSERT INTO FACTURA VALUES('F002','03/03/2023', 21);
INSERT INTO FACTURA VALUES('F003','11/03/2023', 7);
COMMIT;

INSERT INTO CLIENTE VALUES('51125737J', 'MAKI', 'GLORIA FUERTES 2', '606404202');
INSERT INTO CLIENTE VALUES('51325899L', 'CATHA', 'MONIQUE WITTIG 23', '607404255');
INSERT INTO CLIENTE VALUES('61125707L', 'KARLA', 'AV OCAÃ‘A 2', '606555204');
COMMIT;

INSERT INTO CABECERA_PEDIDO VALUES('P001','01/03/2023','51125737J');
INSERT INTO CABECERA_PEDIDO VALUES('P002','01/03/2023','51325899L');
INSERT INTO CABECERA_PEDIDO VALUES('P003','03/03/2023','51125737J');
INSERT INTO CABECERA_PEDIDO VALUES('P004','03/03/2023','61125707L');
INSERT INTO CABECERA_PEDIDO VALUES('P005','11/03/2023','51125737J');
COMMIT;

INSERT INTO CABECERA_ALBARAN VALUES('CAB_ALB01','01/03/2023','P001','F001');
INSERT INTO CABECERA_ALBARAN VALUES('CAB_ALB02','01/03/2023','P002','F001');
INSERT INTO CABECERA_ALBARAN VALUES('CAB_ALB03','03/03/2023','P003','F002');
INSERT INTO CABECERA_ALBARAN VALUES('CAB_ALB04','03/03/2023','P004','F002');
INSERT INTO CABECERA_ALBARAN VALUES('CAB_ALB05','11/03/2023','P005','F003');
COMMIT;

INSERT INTO EMPRESA VALUES('1234560MJ', 'TRANS KINGS', 'AV REYES MAGOS 1');
COMMIT;

INSERT INTO PRODUCTOS VALUES('000000001','PROGESTERONA', 1, '1234560MJ');
INSERT INTO PRODUCTOS VALUES('000000010','ESTRODIOL', 2, '1234560MJ');
INSERT INTO PRODUCTOS VALUES('000000100','DEPAKINE', 0.50, '1234560MJ');
INSERT INTO PRODUCTOS VALUES('000000011','HEURA', 10, '1234560MJ');
INSERT INTO PRODUCTOS VALUES('000000110','LECHE DE AVENA', 1, '1234560MJ');
INSERT INTO PRODUCTOS VALUES('000000111','LECHE DE SOJA', 1, '1234560MJ');
INSERT INTO PRODUCTOS VALUES('001100000','TESTOGEL', 2, '1234560MJ');
INSERT INTO PRODUCTOS VALUES('000100001','MAKEUP', 5, '1234560MJ');
INSERT INTO PRODUCTOS VALUES('000100000','BINDER', 12, '1234560MJ');
INSERT INTO PRODUCTOS VALUES('000100111','CADENA', 4, '1234560MJ');
COMMIT;

INSERT INTO LINEA_PEDIDO VALUES('P1', 1, 'P001', '000000001');
INSERT INTO LINEA_PEDIDO VALUES('P2', 2, 'P001', '000000011');
INSERT INTO LINEA_PEDIDO VALUES('P1', 3, 'P002', '000000110');
INSERT INTO LINEA_PEDIDO VALUES('P2', 4, 'P002', '000000111');
INSERT INTO LINEA_PEDIDO VALUES('P1', 5, 'P003', '000100000');
INSERT INTO LINEA_PEDIDO VALUES('P1', 6, 'P004', '000100111');
INSERT INTO LINEA_PEDIDO VALUES('P1', 7, 'P005', '000000100');
COMMIT;

INSERT INTO LINEA_ALBARAN VALUES('A1', 1, 'CAB_ALB01', '000000001');
INSERT INTO LINEA_ALBARAN VALUES('A2', 2, 'CAB_ALB01', '000000011');
INSERT INTO LINEA_ALBARAN VALUES('A1', 3, 'CAB_ALB02', '000000110');
INSERT INTO LINEA_ALBARAN VALUES('A2', 4, 'CAB_ALB02', '000000111');
INSERT INTO LINEA_ALBARAN VALUES('A1', 5, 'CAB_ALB03', '000100000');
INSERT INTO LINEA_ALBARAN VALUES('A1', 6, 'CAB_ALB04', '000100111');
INSERT INTO LINEA_ALBARAN VALUES('A1', 7, 'CAB_ALB05', '000000100');
COMMIT;




